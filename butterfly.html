<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="utf-8">
		<link href="butterfly.css" rel="stylesheet">
  <title>Butterfly React Test</title>
  <script src="https://unpkg.com/react@16/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@16/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/babel-standalone@6.15.0/babel.min.js"></script>
  </head>
  <body>

    <section class="butterfly-control-block">
        <div class="alert">
          <b>Пожалуйста выделите элемент который хотите перенести</b>
        </div>
    </section>


  </body>

<script type="text/babel">

let items = [
  {
    id: 0,
    text: 'option 1',
    onLeft: true,
    toMove: false
  },
  {
    id: 1,
    text: 'option 2',
    onLeft: true,
    toMove: false
  },
  {
    id: 2,
    text: 'option 3',
    onLeft: true,
    toMove: false
  },
  {
    id: 3,
    text: 'option 4',
    onLeft: false,
    toMove: false
  },
  {
    id: 4,
    text: 'option 5',
    onLeft: true,
    toMove: false
  }
];

const LeftUnit = () => {

  let itemsTemplate = items.map(function(item) {
         return (
           item.onLeft ? <div key={item.id} id = {item.id} className = "block">{item.text}</div> : null
         )})

  return (
  <div className="left-unit">
    <b>Available</b>
    <div className="left-items items">
      {itemsTemplate}
    </div>
  </div>
  )
}

const RightUnit = () => {

  let itemsTemplate = items.map(function(item) {
         return (
           !item.onLeft ? <div key={item.id}  id = {item.id} className = "block">{item.text}</div> : null
         )})

  return (
    <div className="right-unit" >
      <b>Selected</b>
      <div className="right-items items">
       {itemsTemplate}
      </div>
    </div>
  )
}

const CenterUnit = () => {
  return (
    <div className="center-unit">
      <div className="all-to-right btn"> {String.fromCharCode(62)}{String.fromCharCode(62)} </div>
      <div className="to-right move btn"> {String.fromCharCode(62)} </div>
      <div className="to-left move btn"> {String.fromCharCode(60)} </div>
      <div className="all-to-left btn"> {String.fromCharCode(60)}{String.fromCharCode(60)} </div>
    </div>
  )
}

class App extends React.Component {

  handleClick = (evt) => {
    if (evt.target.classList.contains('block') )
    {
      evt.target.classList.toggle('moved');
      items.forEach(function(item) {
      if (item.id == evt.target.id) item.toMove = !item.toMove;
      })
      console.log(items);
      console.log(evt.target.id);
      
    }

    if (evt.target.classList.contains('to-right') )
    {
      
      /*items.forEach(function(item, index) {
        console.log(item.text);
         if (item.toMove & item.onLeft) {
          items.push(items[index]);
          items.splice(index, 1);
        }
      })
      items.forEach(function(item, index) {
        //console.log(item.text)
        if (item.toMove & item.onLeft) {
          item.onLeft = false;
          item.toMove = false;
        }
      })*/
      for (let i = 0; i < items.length; i++) {
        console.log(items[i].text);
        if (items[i].toMove & items[i].onLeft) {
          items.push(items[i]);
          items.splice(i, 1);
          items[i].onLeft = false;
          items[i].toMove = false;
          i--;
        }
      }
      
      this.forceUpdate()
    }

    if (evt.target.classList.contains('to-left') )
    {
      console.log(items)
      items.forEach(function(item, index) {
        if (item.toMove & !item.onLeft) {
          items.push(items[index]);
          items.splice(index, 1);
          item.onLeft = true;
          item.toMove = false;
        }
      })
      this.forceUpdate()
    }
    
    if (evt.target.classList.contains('all-to-right') )
    {
      
      items.forEach(function(item) {
        item.onLeft = false;
      });
      this.forceUpdate()
    }
    if (evt.target.classList.contains('all-to-left') )
    {
      
      items.forEach(function(item) {
        item.onLeft = true;
      });
      this.forceUpdate()
    }
  }

  render() {
  return (
    <div onClick={this.handleClick} className="butterfly-control">
      <LeftUnit />
      <CenterUnit />
      <RightUnit />
    </div>
  )
}}

ReactDOM.render(
  <App />,
  document.querySelector('.butterfly-control-block')
);


</script>

</html>
